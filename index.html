<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parte Dependencia Plana Mayor</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #27ae60;
            --warning-color: #f39c12;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light-color);
            color: var(--dark-color);
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: var(--primary-color);
        }
        
        .section {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .section-title {
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
            color: var(--primary-color);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input[type="text"],
        input[type="number"],
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        input[type="number"] {
            -moz-appearance: textfield;
        }
        
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #2980b9;
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .alert {
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            display: none;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .report-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: center;
            border: 1px solid #ddd;
        }
        
        th {
            background-color: var(--primary-color);
            color: white;
        }
        
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        tr:hover {
            background-color: #e9e9e9;
        }
        
        .total-row {
            font-weight: bold;
            background-color: var(--dark-color) !important;
            color: white;
        }
        
        .novedad-cell {
            max-width: 250px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        @media (max-width: 768px) {
            .responsive-table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
            
            .section {
                padding: 15px;
            }
            
            th, td {
                padding: 8px 10px;
            }
            
            .novedad-cell {
                max-width: 150px;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .section {
                padding: 10px;
            }
            
            input[type="text"],
            input[type="number"],
            textarea {
                padding: 8px;
                font-size: 14px;
            }
            
            .btn {
                padding: 8px 15px;
                font-size: 14px;
            }
            
            th, td {
                padding: 6px 8px;
                font-size: 14px;
            }
            
            .novedad-cell {
                max-width: 100px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Parte Dependencia Plana Mayor</h1>
        
        <div class="section">
            <h2 class="section-title">Registro de Personal</h2>
            
            <div id="alert" class="alert"></div>
            
            <form id="registration-form">
                <div class="form-group">
                    <label for="dependency">Nombre de la Dependencia:</label>
                    <input type="text" id="dependency" required>
                </div>
                
                <div class="form-group">
                    <label for="of">OF:</label>
                    <input type="number" id="of" min="0" value="0" required>
                </div>
                
                <div class="form-group">
                    <label for="me">ME:</label>
                    <input type="number" id="me" min="0" value="0" required>
                </div>
                
                <div class="form-group">
                    <label for="pt">PT:</label>
                    <input type="number" id="pt" min="0" value="0" required>
                </div>
                
                <div class="form-group">
                    <label for="pp">PP:</label>
                    <input type="number" id="pp" min="0" value="0" required>
                </div>
                
                <div class="form-group">
                    <label for="ap">AP:</label>
                    <input type="number" id="ap" min="0" value="0" required>
                </div>
                
                <div class="form-group">
                    <label for="novedad">Novedad:</label>
                    <textarea id="novedad" placeholder="Ingrese cualquier novedad o observación"></textarea>
                </div>
                
                <button type="submit" class="btn btn-block">Registrar Parte</button>
            </form>
        </div>
        
        <div class="section">
            <h2 class="section-title">Informe Detallado</h2>
            
            <div class="report-container">
                <table id="report-table">
                    <thead>
                        <tr>
                            <th>Dependencia</th>
                            <th>OF</th>
                            <th>ME</th>
                            <th>PT</th>
                            <th>PP</th>
                            <th>AP</th>
                            <th>Total</th>
                            <th>Novedad</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="report-body">
                        <!-- Los datos se cargarán aquí dinámicamente -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('registration-form');
            const alertBox = document.getElementById('alert');
            const reportBody = document.getElementById('report-body');
            
            // Cargar datos al iniciar
            loadData();
            
            // Manejar el envío del formulario
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Obtener valores del formulario
                const dependency = document.getElementById('dependency').value.trim();
                const of = parseInt(document.getElementById('of').value);
                const me = parseInt(document.getElementById('me').value);
                const pt = parseInt(document.getElementById('pt').value);
                const pp = parseInt(document.getElementById('pp').value);
                const ap = parseInt(document.getElementById('ap').value);
                const novedad = document.getElementById('novedad').value.trim();
                
                // Validar nombre de dependencia
                if (!dependency) {
                    showAlert('El nombre de la dependencia es obligatorio', 'error');
                    return;
                }
                
                // Validar valores numéricos
                if (isNaN(of) || isNaN(me) || isNaN(pt) || isNaN(pp) || isNaN(ap) || 
                    of < 0 || me < 0 || pt < 0 || pp < 0 || ap < 0) {
                    showAlert('Todos los valores deben ser números positivos', 'error');
                    return;
                }
                
                // Calcular total
                const total = of + me + pt + pp + ap;
                
                // Crear objeto con los datos
                const data = {
                    dependency,
                    of,
                    me,
                    pt,
                    pp,
                    ap,
                    total,
                    novedad: novedad || "Sin novedad" // Si no hay novedad, mostrar "Sin novedad"
                };
                
                // Guardar los datos
                saveData(data);
                
                // Mostrar mensaje de éxito
                showAlert(`Datos de "${dependency}" registrados correctamente`, 'success');
                
                // Limpiar formulario
                form.reset();
                document.getElementById('of').value = '0';
                document.getElementById('me').value = '0';
                document.getElementById('pt').value = '0';
                document.getElementById('pp').value = '0';
                document.getElementById('ap').value = '0';
                document.getElementById('novedad').value = '';
                
                // Actualizar el informe
                loadData();
            });
            
            // Función para mostrar alertas
            function showAlert(message, type) {
                alertBox.textContent = message;
                alertBox.className = 'alert';
                alertBox.classList.add(`alert-${type}`);
                alertBox.style.display = 'block';
                
                // Ocultar la alerta después de 3 segundos
                setTimeout(() => {
                    alertBox.style.display = 'none';
                }, 3000);
            }
            
            // Función para guardar datos en localStorage
            function saveData(data) {
                // Obtener datos existentes o inicializar array vacío
                let dependencies = JSON.parse(localStorage.getItem('dependencies')) || [];
                
                // Verificar si la dependencia ya existe
                const existingIndex = dependencies.findIndex(item => item.dependency.toLowerCase() === data.dependency.toLowerCase());
                
                if (existingIndex !== -1) {
                    // Actualizar registro existente
                    dependencies[existingIndex] = data;
                    showAlert(`Datos de "${data.dependency}" actualizados correctamente`, 'success');
                } else {
                    // Agregar nuevo registro
                    dependencies.push(data);
                }
                
                // Guardar en localStorage
                localStorage.setItem('dependencies', JSON.stringify(dependencies));
            }
            
            // Función para cargar datos desde localStorage
            function loadData() {
                const dependencies = JSON.parse(localStorage.getItem('dependencies')) || [];
                reportBody.innerHTML = '';
                
                // Variables para totales
                let totalOF = 0, totalME = 0, totalPT = 0, totalPP = 0, totalAP = 0, grandTotal = 0;
                
                // Generar filas de la tabla
                dependencies.forEach((item, index) => {
                    const row = document.createElement('tr');
                    
                    // Sumar a los totales
                    totalOF += item.of;
                    totalME += item.me;
                    totalPT += item.pt;
                    totalPP += item.pp;
                    totalAP += item.ap;
                    grandTotal += item.total;
                    
                    row.innerHTML = `
                        <td>${item.dependency}</td>
                        <td>${item.of}</td>
                        <td>${item.me}</td>
                        <td>${item.pt}</td>
                        <td>${item.pp}</td>
                        <td>${item.ap}</td>
                        <td>${item.total}</td>
                        <td class="novedad-cell" title="${item.novedad}">${item.novedad}</td>
                        <td>
                            <button class="btn edit-btn" data-index="${index}">Editar</button>
                            <button class="btn delete-btn" data-index="${index}" style="background-color: var(--accent-color);">Eliminar</button>
                        </td>
                    `;
                    
                    reportBody.appendChild(row);
                });
                
                // Agregar fila de totales
                if (dependencies.length > 0) {
                    const totalRow = document.createElement('tr');
                    totalRow.className = 'total-row';
                    totalRow.innerHTML = `
                        <td>TOTALES</td>
                        <td>${totalOF}</td>
                        <td>${totalME}</td>
                        <td>${totalPT}</td>
                        <td>${totalPP}</td>
                        <td>${totalAP}</td>
                        <td>${grandTotal}</td>
                        <td></td>
                        <td></td>
                    `;
                    reportBody.appendChild(totalRow);
                }
                
                // Agregar event listeners a los botones de editar y eliminar
                document.querySelectorAll('.edit-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = this.getAttribute('data-index');
                        editDependency(index);
                    });
                });
                
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = this.getAttribute('data-index');
                        deleteDependency(index);
                    });
                });
            }
            
            // Función para editar una dependencia
            function editDependency(index) {
                const dependencies = JSON.parse(localStorage.getItem('dependencies')) || [];
                
                if (index >= 0 && index < dependencies.length) {
                    const item = dependencies[index];
                    
                    // Llenar el formulario con los datos existentes
                    document.getElementById('dependency').value = item.dependency;
                    document.getElementById('of').value = item.of;
                    document.getElementById('me').value = item.me;
                    document.getElementById('pt').value = item.pt;
                    document.getElementById('pp').value = item.pp;
                    document.getElementById('ap').value = item.ap;
                    document.getElementById('novedad').value = item.novedad === "Sin novedad" ? "" : item.novedad;
                    
                    // Desplazarse al formulario
                    document.getElementById('dependency').focus();
                }
            }
            
            // Función para eliminar una dependencia
            function deleteDependency(index) {
                if (confirm('¿Está seguro que desea eliminar esta dependencia?')) {
                    const dependencies = JSON.parse(localStorage.getItem('dependencies')) || [];
                    
                    if (index >= 0 && index < dependencies.length) {
                        const deleted = dependencies.splice(index, 1);
                        localStorage.setItem('dependencies', JSON.stringify(dependencies));
                        showAlert(`Dependencia "${deleted[0].dependency}" eliminada`, 'success');
                        loadData();
                    }
                }
            }
        });
    </script>
</body>
</html>